================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Id$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]

PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]

* Fix autodeployment of applications that have configuration errors.
  If autodeployment fails, create DeployedApplication object and register
  what we deployed (xml or war or dir - a single file) as redeployResource.
  If it is updated the application will be redeployed.
  + ContainerBase patch adds display of failed apps in manager. They can be
  listed and undeployed.
  http://people.apache.org/~kkolinko/patches/2011-11-14_tc6_HostConfig.patch
  http://people.apache.org/~kkolinko/patches/2011-11-14_tc6_ContainerBase.patch
  +1: kkolinko
  +0: kfujino: Question of if host.addChild(context) threw IllegalStateException.
      E.g. case of deployDirectory.
      If META-INF/context.xml exist in Directory, context.xml is copied to configBase.
      If host.addChild(context) threw IllegalStateException, only a directory is 
      registered into redeployResources. Context.xml does not register into redeployResources.
      If manager app execute undeploy(or delete directory), directory is deleted 
      but context.xml isn't deleted.
      Should (conf/Catalina/localhost/)context.xml be registered into redeployResources? 
      Or need to delete context.xml manually? 
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52579
  Propose new implementation of ByteChunk.toStringInternal().
  This fix does not reintroduce issue BZ51400.
  This fix avoids http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6196991.
  https://issues.apache.org/bugzilla/attachment.cgi?id=28274
  +1: kfujino, fhanik
  -0: markt - https://issues.apache.org/bugzilla/show_bug.cgi?id=52579#c8
  -1: 

* https://issues.apache.org/bugzilla/show_bug.cgi?id=52811
  Fix parsing of Content-Type
  http://svn.apache.org/viewvc?rev=1300154&view=rev (new HTTP header parser)
  http://svn.apache.org/viewvc?rev=1300155&view=rev (the actual fix)
  http://svn.apache.org/viewvc?rev=1304275&view=rev (case insensitivity)
  http://svn.apache.org/viewvc?rev=1304895&view=rev (case insensitivity)
  http://svn.apache.org/viewvc?rev=1345752&view=rev (BZ 53353)
  http://svn.apache.org/viewvc?rev=1345754&view=rev (BZ 53353)
  (=r1300157+r1300161+r1304897+1345755 in TC7)
  +1: markt
   0: fhanik - introducing a new parser this late into a release seems too risky for 6
  +0: schultz - agree with fhanik: seems risky at this stage
  +0: kkolinko:
        Maybe there can be a simpler, not spec-imposing solution for 6.0?
        E.g. disable parsing and appending of charset if
        contentType.indexOf('\"') >= 0.
        A good note about original proposal is that it does not affect
        request parsing, so only broken webapps may break, not broken clients.
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52918
  Add WebSocket support to Tomcat 6
  +1: fhanik

* Backport UserDataHelper class (issue 52184)
  Provide greater control over the logging of errors triggered by invalid
  input data (i.e. data over which Tomcat has no control).

  Note: cookies logging (o.a.t.util.http.Cookies) does not need to be
  addressed in Tomcat 6, because all logging in that class here is done at
  debug level.

  http://people.apache.org/~kkolinko/patches/2012-03-26_tc6_UserDataHelper.patch
  (includes a new file, copied from trunk:
  svn cp ../../trunk/java/org/apache/tomcat/util/log/UserDataHelper.java@1242371 java/org/apache/tomcat/util/log/UserDataHelper.java
  )
  +1: kkolinko
  -1:

* For https://issues.apache.org/bugzilla/show_bug.cgi?id=52055
  Ensure that filters are recycled.
  Inspired by r1334790 (TC7), r565964 (TC6 Nio)
  I do not have evidence that this change matters, but it should not hurt.
  The nextRequest() method already recycles the filters. If it has been called,
  then lastActiveFilter is -1 and the new code will be NOOP.
  http://people.apache.org/~kkolinko/patches/2012-06-02_tc6_recycle.patch
  +1: kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53047
  Allow database realms configured with an all roles mode that is authentication
  only to not have to define a role table
  http://svn.apache.org/viewvc?rev=1348498&view=rev
  +1: markt, kfujino
  +1: kkolinko (docs update would be needed:
       at least set required="false" on roleNameCol, userRoleTable
       in config/realm.html), schultz
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53513
  Fix race condition between the processing of session sync message and transfer
  complete message.
  http://svn.apache.org/viewvc?view=revision&revision=1359044
  +1: kfujino, kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53607
  To avoid NPE, set TCP PING data to ChannelMessage.
  http://svn.apache.org/viewvc?view=revision&revision=1367456
  +1: kfujino, kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53606
  Fix possible NPE when sending pings between cluster nodes.
  http://svn.apache.org/viewvc?view=revision&revision=1366961
  +1: kfujino, kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53584
  Ignore path parameters when comparing URIs for FORM authentication. This
  prevents users being prompted twice for passwords when logging in when session
  IDs are being encoded as path parameters.
  http://svn.apache.org/viewvc?rev=1370537&view=rev
  +1: markt, schultz
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53481
  Add support for SSLHonorCipherOrder
  http://svn.apache.org/viewvc?view=revision&revision=1371298
  http://svn.apache.org/viewvc?view=revision&revision=1371302 (rolls-back inadvertent addition of TOMCAT-NEXT.txt)
  +1: schultz
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48692
  Provide option to parse application/x-www-form-urlencoded PUT requests
  Patch from 7.0.x should apply relatively cleanly, as it is very small:
  http://svn.apache.org/viewvc?view=revision&revision=1041892
  +1: schultz
  -1: kkolinko: r1041892 is not enough. It has bad formatting, a HashMap
  protected field (should be 'Map'), etc. See the current code of Tomcat 7.
      schultz: current trunk and TC7 code has HashSet<String>. Am I misunderstanding?
               I will also add http://svn.apache.org/viewvc?view=revision&revision=1043983
                           and http://svn.apache.org/viewvc?view=revision&revision=1049264
               to fix the formatting issues.

* Further fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=53071
  - Use standard text for standard HTTP error codes 
  - Trim Jasper error messages
  http://svn.apache.org/viewvc?view=revision&revision=1361991
  http://svn.apache.org/viewvc?rev=1372131&view=rev
  +1: markt, rjung, kkolinko
  -1:
  rjung: 1361991 doesn't apply cleanly, because the list of status codes
         was extended in 1361263 and 1361962.
         I would be +1 to backport those two as well.
  kkolinko: +1 for 1361263 and 1361962 as well.
  
  
PATCHES/ISSUES THAT ARE STALLED

* Backport JSP unloading patch (BZ48358).
  The patch has substantially changed since the original version.
  Original revisions are: 937787, 1028377, 1028389, 1028396, 1028861, 1028862, 1028863,
  1028935, 1028939, 1028940, 1028944, 1028950, 1030014, 1030037
  Combined TC 6 patch:
  http://people.apache.org/~rjung/patches/BZ48358-JSP_Unloading-TC6_20101118.patch
  +1: rjung
  -0: markt - http://markmail.org/thread/777be426ulcfmdd3 suggests there may be
              a memory leak in this code somewhere. I'd like to get to the
              bottom of that before porting this
      rjung:  I started a discussion about JSPs and memory on the dev list.
              The updated patch fixes a race condition.
              We can stall this item until we get some feedback about 7.0.5.
      markt - r1172614 needs to be included in this proposal. With that patch,
              my testing shows that the unloading works as designed
  -1:
