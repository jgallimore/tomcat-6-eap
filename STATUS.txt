================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Revision$ $Date$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]

PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]

* Fix issue where the first request for a deleted JSPs returns as if the JSP
  still exists.
  http://svn.apache.org/viewvc?view=rev&revision=683969
  +1: markt
   0: remm (looks risky, very minor problem)
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45608
  Prevent race condition for allocate/deallocate in StandardWrapper
  http://svn.apache.org/viewvc?rev=685177&view=rev
  +1: markt
   0: remm: The only unsafe usage of this field is to implement the gimmick loop-wait hack,
            which to me means adding any sort of sync is not worth it.
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45074
  http://svn.apache.org/viewvc?rev=689402&view=rev
  +1: jfclere
   0: markt: The OP was using linux so I assume they saw some benefit.
             If this is goign to be applied, the docs should be
             updated as well.
  -0: remm: configuring this is useless (esp on Windows, only the default behavior gives acceptable performance)
  -1: 

* Handle session suffix rewrite at JvmRouteBinderValve with parallel requests from same client
  http://svn.apache.org/viewvc?rev=693378&view=rev
  +1: pero, fhanik, markt, jim
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44382
  Use HttpOnly for session cookies. This is enabled by default. Feel free to
  caveat your vote with a preference for disabled by default.
  http://svn.apache.org/viewvc?rev=694992&view=rev
  +1: mark (prefer enabled, happy with disabled), rjung
   0: remm (not so elegant, not sure about default value)
      markt It can be improved once the API is fixed in the 3.0 spec
      fhanik why did we change it in trunk to begin with if we are gonna change it again when the spec comes out
             lets just implement the spec in trunk, and discuss the simplest solution for 6.0.x
             but I don't agree with changing the default value
  -1: 
  rjung: slightly prefer enabled for 6.0.x because of increased security by default,
         but disabled for tc5.5.x because of the small risk of breaking existing apps.

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45026
  Never use empty reason phrase.
  http://svn.apache.org/viewvc?rev=697183&view=rev
  +1: rjung, mturk, markt, jim
   0: remm (also affects to the two other AJP connectors)

* Allow huge request body packets for AJP13.
  This was already applied to connectors, but never
  carried forward to trunk and tc6.0.x.
  http://svn.apache.org/viewvc?rev=697192&view=rev
  Original change: http://svn.apache.org/viewvc?rev=486217&view=rev
  +1: rjung, mturk, markt, pero, jim
   0: remm (also affects to the two other AJP connectors)

* Fix serialisation issue reported by Find Bugs
  http://svn.apache.org/viewvc?rev=699633&view=rev
  +1: markt
   0: remm (StdContext was marked as Serializable for an experiment; obviously it won't work)
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45933
  Don't use xml parser from web-app to process tld files
  http://svn.apache.org/viewvc?rev=701355&view=rev
  +1: markt
  -0: remm (it is a refactoring, and is not appropriate to me in 6.0.x)
           markt - It is a refactoring but the refactoring was necessary
                   to change when TLDs were processed to avoid the bug. It
                   isn't refactoring for the sake of refactoring.

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45403
  See commit message for details of negligable performance impact
  http://svn.apache.org/viewvc?rev=701358&view=rev
  +1: markt
  -0: remm (I also do not think the patch is a good idea as a backport)

* Backport NCDFE fix from trunk (TCK failures without it)
  http://svn.apache.org/viewvc?rev=640888&view=rev 
  +1: markt
   0: remm (no clue how it can cause a NCDF, and the TCK actually works for me; besides that code is 
            really old to me, so where would this come from ?)
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41861
  Add major version number to Tomcat service name created by Windows installer
  http://svn.apache.org/viewvc?rev=710066&view=rev
  +1: markt, rjung
  -1: 
  rjung: tomcat.nsi already uses replacement patterns like @VERSION@.
         So it might be more robust, to add another replacement like
         VERSION_MAJOR or VERSION_MAIN to dist.xml resolving
         to ${version.major} or $version.major}.${version.minor}
         and then replace all occurences of "6" with @VERSION_MAJOR@
         or @VERSION_MAIN@.
  rjung: Should be added to PR_DESCRIPTION in bin/service.bat as well.
         Just did that for trunk (r711934; but it contains also other changes).
         Caution: at the moment there's no @VERSION@ substitution for service.bat.

* I have summarized all the NIO fixes into one patch for those who wish to test it
* It includes patch [1]-[6] below and can be found at:
* http://people.apache.org/~fhanik/tomcat/uber-patch.txt

* [1] Fix send file bug - correctly notify the poller without having to wait for it to wake up
  http://svn.apache.org/viewvc?rev=719129&view=rev
  +1: fhanik, pero, markt, jim
  -1: 

* [2] Prevent async close NPE on already closed sockets
  http://people.apache.org/~fhanik/tomcat/comet-close-2.patch
  +1: fhanik, markt (need to fix indenting)
  -1: 

* [3] Add ability to fix the keyAlias in NIO/SSL
  http://svn.apache.org/viewvc?rev=720587&view=rev
  http://svn.apache.org/viewvc?rev=720553&view=rev 
  +1: fhanik, markt
  -1:

* [4] Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45154 (add sendfile support to NIO/SSL) - performance improvement
  http://svn.apache.org/viewvc?rev=720724&view=rev
  http://svn.apache.org/viewvc?rev=720728&view=rev 
  http://svn.apache.org/viewvc?rev=725417&view=rev
  +1: fhanik, jim
  -1: 
  
* [5] Fix Comet interest registration bug
  http://people.apache.org/~fhanik/tomcat/comet-ops.patch
  +1: fhanik
  -1: 

* [6] Fix file descriptor leak during send file behavior in NIO connector
  http://svn.apache.org/viewvc?rev=729191&view=rev 
  +1: fhanik, markt, jim
  -1: 
  

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42693
  Fix compilation of recursive tags
  http://svn.apache.org/viewvc?rev=720046&view=rev
  +1: markt, fhanik
  -1: 

* Use consistent (and more useful) JPDA defaults in catalina.bat
  http://svn.apache.org/viewvc?rev=721040&view=rev
  +1: markt, fhanik
  -1: 

* Changes required to run with a security manager
  http://svn.apache.org/viewvc?rev=721286&view=rev
  http://svn.apache.org/viewvc?rev=721704&view=rev
  http://svn.apache.org/viewvc?rev=721708&view=rev
  http://svn.apache.org/viewvc?rev=721886&view=rev
  +1: markt, fhanik
   0: billbarker: Haven't tried to break it yet, but the 4th patch potentially
      offers access to static fields in ELContextImpl and ELResolverImpl that could 
      possibly be exploited by a malicious webapp.
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46304
  Excludes performance issues
  Use Principal when calling doFilterEvent()
  http://svn.apache.org/viewvc?rev=728768&view=rev
  +1: markt, fhanik
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46357
  Correct test for host's parent must be an engine
  http://svn.apache.org/viewvc?rev=729567&view=rev
  +1: markt
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46381
  Composite expressions used for attribute values must be coerced to Strings
  http://svn.apache.org/viewvc?rev=729569&view=rev
  +1: markt
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46351
  Build script re-factoring
  Patch provided by Marc Guillemot
  http://svn.apache.org/viewvc?rev=729681&view=rev
  +1: markt, jim
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46298
  Throw and SQLException with a useful message rather than a NPE if the URL for
  the JDBCRealm is invalid.
  Based on a patch by Owen Jacobson
  http://svn.apache.org/viewvc?rev=729809&view=rev
  +1: markt, remm
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46261
  %2F in a context path should be interpreted literally, not as /. That is what
  # is for.
  http://svn.apache.org/viewvc?rev=729571&view=rev 
  +1: markt
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42707
  Make adding a host alias via jmx take effect immediately
  http://svn.apache.org/viewvc?rev=712467&view=rev 
  +1: markt
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45261
  Add a new SimpleCoordinator for tribes provided by Robert Newson
  http://svn.apache.org/viewvc?rev=729815&view=rev
  http://svn.apache.org/viewvc?rev=729934&view=rev
  +1: markt, fhanik
  -1: 

* Print user friendly message when attempting to shutdown and shutdown port is disabled
  http://svn.apache.org/viewvc?rev=730178&view=rev
  +1: fhanik, remm
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=36923
  If EL is disabled, treat it as template text
  http://svn.apache.org/viewvc?rev=730590&view=rev
  +1: markt
   0: remm (needs TCK testing)
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46462
  Limit package test to just the o.a.jsp package to allow use of packages such
  as o.a.jspwiki
  http://svn.apache.org/viewvc?rev=730694&view=rev
  +1: markt, remm
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=37458
  Correct sync issue that leads to NPE in rare circumstances
  Patch provided by Konstantin Kolinko
  http://svn.apache.org/viewvc?rev=730735&view=rev
  +1: markt
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46471
  Use jar url and tag file path to uniquely ID a tag file to prevent naming
  clashes
  +1: markt
  -1: remm (e.printStackTrace in the patch, and maybe usage of URL constructs which could lead to issues
            when not filesystem based; also needs TCK testing)

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=37515
  Add options for 1.6 and 1.7 source and target to JDT compiler
  http://svn.apache.org/viewvc?rev=731773&view=rev
  +1: markt, remm
  -1: 
