================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Id$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]

PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]

* Fix the maven stuff for the maven repo.
  Before it does't find tomcat-juli.jar and the remoteRepository seems broken .
  http://people.apache.org/~jfclere/patches/maven.patch.100711
  +1: jfclere
  -1: fhanik - easier to pass in the root path (lib/bin) to the macro instead of hacking around it
               if we remove the SCP auto feature, then there should be something to replace it with
               (http://ant.apache.org/manual/OptionalTasks/scp.html)
  +1: kkolinko: +1 for the updated patch (maven.patch.100711)
      I still think that it is not so good to remove the old code of <remoteRepository/>,
      because it ignores ${maven.repo.url} parameter provided by deploy-snapshot,
      deploy-staging and deploy-release targets. Maybe leave old code as a comment
      and fix it later if needed? I think that actually nobody besides the release manager
      uses this, so I am letting this pass.

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48545
  Truststores don't have to have passwords
  Based on a patch by 'smmwpf54'
  https://issues.apache.org/bugzilla/attachment.cgi?id=25848
  +1: markt
  -1:
  Comments on previous patch
    jfclere: Doc says it should use keystorePass (http://tomcat.apache.org/tomcat-6.0-doc/config/http.html).
               so that would break existing configurations.
      markt: It shouldn't break existing configs. JSSE allows trust stores to be
             read without providing the password
      kkolinko: 1. My understanding of KeyStore.load(stream,pwd) doc is that when the
             password is not needed to open a store, it is used to verify its integrity.
             So, this patch changes behaviour: skips the verification.
             2. Note, that the password might be provided by overriding the
             getKeystorePassword() method. There is no way to provide such password
             for the truststore in the new code.
             3. I would be fine if this new behaviour in TC6 were triggered by some
             system property, but defaults to the old behaviour.


* Configure Tomcat to use HttpOnly for session cookies by default
  http://people.apache.org/~kkolinko/patches/2010-04-21_tc6_context_httpOnly.patch
  +1: kkolinko
  -0: markt - There wasn't consensus previously.
            - If you are going to change the default, do it in the code
  -1:

* Expose the new WebappLoader flag in the VirtualWebappLoader,
  but allow alternative name searchVirtualFirst to make it
  consistent with the "virtual" terminology.
  Now you can decide, whether the virtual paths will
  be searched before the webapp or after it.
  If searched before, external resources take precendence
  over internal ones. Before that change one couldn't overwrite
  resources already present in the webapp.
  http://svn.apache.org/viewvc?view=revision&revision=936825
  http://people.apache.org/~rjung/patches/2010-05-14-loader-backport-r936825.patch
  +1: rjung
  -1:
  -0: kkolinko: The patch itself is OK, but I think having a synonym will
   cause confusion. I'd prefer not to invent a new name, but mention the
   one that we already have when documenting virtualClasspath.

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49099
  Provide a mechanism for including requests rejected by the CoyoteAdapter in
  the standard access log
  http://people.apache.org/~markt/patches/2010-07-07-bug49099.patch
  This is a backport of: r950587, r950809, r951018, r951093, r951447,
                         r951892, r952295
  +1: markt
  -1:


* Backport the CSRF prevention filter to Tomcat 6 and configure the Manager and
  Host Manager applications to use it. The configuration is such that the using
  the old roles (manager, admin) will work and will bypass the CSRF protection
  but using the new roles (manager-gui, admin-gui etc.) will not bypass the CSRF
  protection.
  http://people.apache.org/~markt/patches/2010-06-26-crsf-prevention-filter-tc6.patch
  http://svn.apache.org/viewvc?rev=962865&view=rev
  http://svn.apache.org/viewvc?rev=962872&view=rev
  http://svn.apache.org/viewvc?rev=962881&view=rev
  http://svn.apache.org/viewvc?rev=962900&view=rev
  http://svn.apache.org/viewvc?rev=988448&view=rev
  +1: markt
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49217
  Ensure EL identifiers conform to the Java Language Specification with an
  option to disable this check.
  https://issues.apache.org/bugzilla/attachment.cgi?id=25727
  +1: markt
  +1: kkolinko (if doc part is adjusted to the code)
  -1:
   kkolinko: doc says the SKIP_* property defaults to false, but in the code the
    default is true. (Maybe tie it to STRICT_SERVLET_COMPLIANCE?)
    Maybe document this in the "Specification" part of the systemprops.xml,
    instead of "Expression Language" as done in 7.0.2?

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49555
  Correctly handle tag libraries that use functions defined in static inner
  classes
  http://svn.apache.org/viewvc?rev=961948&view=rev
  http://svn.apache.org/viewvc?rev=963106&view=rev
  http://svn.apache.org/viewvc?rev=966863&view=rev
  +1: markt, kkolinko
  -1:
   kkolinko: I was worried that ELFunctionMapper$PrivilegedGetTccl
   should be preloaded in o.a.jasper.security.SecurityClassLoad,
   but from debugging it looks that it is called by Tomcat code only
   (JspServlet).

* Make sure Contexts defined in server.xml pick up any configClass setting from
  the parent Host.
  http://people.apache.org/~markt/patches/2010-09-11-configClass.patch
  +1: markt
  -1:
   kkolinko: A bit hard to understand. The proposal is about a rule that processes
    <Context>, but LifecycleListenerRule is used for <Engine> and <Host> as well.

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49497
  Stop accepting new requests (inc keep-alive) once the BIO connector is paused
  and the current request has finished processing
  https://issues.apache.org/bugzilla/attachment.cgi?id=26094
  +1: markt
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49625
  Ensure Vary header is set if response may be compressed rather than only
  setting it if it is compressed.
  http://svn.apache.org/viewvc?rev=1002133&view=rev
  (patch needs to be applied separately to BIO, NIO and APR HTTP connectors)
  +1: markt
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49665
  Better handling for missing TLD files. Report JSP filename and location.
  http://svn.apache.org/viewvc?rev=1002274&view=rev
  +1: markt, kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49730
  Correct race condition in StandardThreadExecutor that can lead to long delays
  in processing requests. Patch provided by Sylvain Laurent.
  https://issues.apache.org/bugzilla/attachment.cgi?id=25865
  +1: markt
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49860
  Add support for trailing headers.
  http://svn.apache.org/viewvc?rev=1003461&view=rev
  Note: Don't change return type for parseEndChunk(), just return true.
  +1: markt
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50026
  Force DefaultServlet to serve all resources relative to context root
  regardless of mappings/mount point.
  Prevents access to WEB-INF and META-INF when the default servlet is
  mapped to a sub-path. Also fixes WebdavServlet, which is affected for GET
  requests.
  This is a breaking change for anyone re-mapping DefaultServlet to a sub-path
  (current behaviour is to remount the entire web application under the path,
  which exposes WEB-INF/META-INF).
  http://svn.apache.org/viewvc?rev=1004393&view=rev
  http://svn.apache.org/viewvc?rev=1004409&view=rev
  http://svn.apache.org/viewvc?rev=1004415&view=rev
  http://svn.apache.org/viewvc?rev=1004912&view=rev (fix for includes)
  +1: timw
  -1:
   kkolinko: See Re:r1004393 on dev@
    timw: fixed in http://svn.apache.org/viewvc?rev=1004912&view=rev

* Backport all JRE leak prevention listener changes to tc6
  http://people.apache.org/~markt/patches/2010-10-05-leak-preotection-tc6.patch
  +1: markt, kkolinko
  -1:

  Additional patch:
  http://svn.apache.org/viewvc?rev=1004868&view=rev
  http://svn.apache.org/viewvc?rev=1004869&view=rev
  +1: kkolinko
  -1:

* Fix path parameter handling. Currently the following URL fails with a 404:
  http://localhost:8080/examples/jsp/snp;x=y/snoop.jsp
  http://people.apache.org/~markt/patches/2010-10-06-path-param-tc6.patch
  +1: markt
  -0: kkolinko: see Re:r1005192 thread on dev@

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49965
  Use correct i18n resources for StringManager in JAASRealm
  http://people.apache.org/~markt/patches/2010-10-07-bug49965-tc6.patch
  (Port of http://svn.apache.org/viewvc?view=revision&revision=920820)
  +1: markt
  -1:
  -0: kkolinko: It is amazing that the patch just removes N lines and fixes
    the issue, but I think that removing static protected fields is not
    good for binary compatibility between releases. Alternative patch
    proposed below.

  Alternative patch:
  http://people.apache.org/~kkolinko/patches/2010-10-13_tc6_bug49965.patch
  +1: kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49811
  Add context option to disable URL re-writing and session parsing from URLs
  Based on a patch by Wesley.
  https://issues.apache.org/bugzilla/attachment.cgi?id=26135
  +1: markt, kkolinko
  -1:
   kkolinko: minor thoughts, not mandatory:
     - I think in CoyoteAdapter.java the added "if (isURLRewritingDisabled(request))" call
      should better be moved below setWrapper(..), for better readability.
     - Implementation of CoyoteAdapter.isURLRewritingDisabled(request) could call
      request.getContext(), because request.setContext(..) was already called,
      but I do not insist on such changes.
     - Do not remove "// Make sure no session ID is returned" comment.
     - Documentation update will be needed.

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50066
  Compile recursive tag file if it depends on a JAR. Patch provided by Sylvain
  Laurent.
  https://issues.apache.org/bugzilla/attachment.cgi?id=26149
  +1: markt, kkolinko
  -1:

* Avoid unnecessary cast
  http://svn.apache.org/viewvc?rev=1022134&view=rev
  +1: markt, kkolinko, rjung
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49428
  Add a work-around for the known namespace issues for some Microsoft WebDAV
  clients. Based on the patch provided by Panagiotis Astithas.
  http://svn.apache.org/viewvc?rev=1022120&view=rev
  +1: kkolinko
  -1:
