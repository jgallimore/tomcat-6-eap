================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Id$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]

PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]

* Fix the maven stuff for the maven repo.
  Before it does't find tomcat-juli.jar and the remoteRepository seems broken .
  http://people.apache.org/~jfclere/patches/maven.patch.100711
  +1: jfclere
  -1: fhanik - easier to pass in the root path (lib/bin) to the macro instead of hacking around it
               if we remove the SCP auto feature, then there should be something to replace it with
               (http://ant.apache.org/manual/OptionalTasks/scp.html)
  +1: kkolinko: +1 for the updated patch (maven.patch.100711)
      I still think that it is not so good to remove the old code of <remoteRepository/>,
      because it ignores ${maven.repo.url} parameter provided by deploy-snapshot,
      deploy-staging and deploy-release targets. Maybe leave old code as a comment
      and fix it later if needed? I think that actually nobody besides the release manager
      uses this, so I am letting this pass.

* Expose the new WebappLoader flag in the VirtualWebappLoader,
  but allow alternative name searchVirtualFirst to make it
  consistent with the "virtual" terminology.
  Now you can decide, whether the virtual paths will
  be searched before the webapp or after it.
  If searched before, external resources take precendence
  over internal ones. Before that change one couldn't overwrite
  resources already present in the webapp.
  http://svn.apache.org/viewvc?view=revision&revision=936825
  http://people.apache.org/~rjung/patches/2010-05-14-loader-backport-r936825.patch
  +1: rjung, funkman, kkolinko
  -1:

* Backport JSP unloading patch (BZ48358).
  The patch has substantially changed since the original version.
  Original revisions are: 937787, 1028377, 1028389, 1028396, 1028861, 1028862, 1028863,
  1028935, 1028939, 1028940, 1028944, 1028950, 1030014, 1030037
  Combined TC 6 patch:
  http://people.apache.org/~rjung/patches/BZ48358-JSP_Unloading-TC6_20101118.patch
  +1: rjung
  -0: markt - http://markmail.org/thread/777be426ulcfmdd3 suggests there may be
              a memory leak in this code somewhere. I'd like to get to the
              bottom of that before porting this
      rjung:  I started a discussion about JSPs and memory on the dev list.
              The updated patch fixes a race condition.
              We can stall this item until we get some feedback about 7.0.5.
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50771
  Ensure HttpServletRequest#getAuthType() returns the name of the authentication scheme 
  if request has already been authenticated.
  http://svn.apache.org/viewvc?view=revision&revision=1070409
  https://issues.apache.org/bugzilla/attachment.cgi?id=26649 (patch against tc6.0)
  +1: kfujino, markt, kkolinko
  -1:

* Add additional configuration options to the DIGEST authenticator
  http://people.apache.org/~markt/patches/2011-04-01-digest-tc6.patch
  +1: markt
  +1: schultz : if s/nOnce/nonce/g for the whole file, not just some of it
  -1:

* Add StuckThreadDetectionValve
  https://github.com/sylvainlaurent/tomcat60/commit/252334f958877221ecb2dc64ee0fd12bb77e360b
  +1: slaurent
  +1: kkolinko: several comments are below
  -1:
  kkolinko: To view/download this as a patch file you add ".diff" to the URL above. That is:
  https://github.com/sylvainlaurent/tomcat60/commit/252334f958877221ecb2dc64ee0fd12bb77e360b.diff

  kkolinko: Minor glitches:
    - In mbeans-descriptors.xml:
      - There are no properties "asyncSupported", "stateName" in TC6 version of this valve.
    - In valve.xml:
      - s/tomcat log/Tomcat log/ (or Apache Tomcat log)
    - In StuckThreadDetectionValve.java:
      - s/private class CompletedStuckThread/private static class CompletedStuckThread/
        MonitoredThread can be made static as well.
      - result[i] = idList.get(i); and arguments to sm.getString()
        I'd prefer the boxing/unboxing conversion to be coded explicitly.
      - s/new Long(/Long.valueOf(/
      - ConcurrentHashMap: Maybe the defaults could be tuned with system properties.
        I wonder whether ConcurrentHashMap.DEFAULT_CONCURRENCY_LEVEL which is 16 is enough.
      - getStuckThreadIds() returns a list of ids. It might be useful to
        have a similar method that returns Thread.getName() names.

* Fix truncated cookies.
  Based on https://issues.jboss.org/browse/JBWEB-196
  http://people.apache.org/~jfclere/patches/patch.110622.txt
  +1: jfclere
  -1: markt Should use same mechanism for this as Tomcat 7 
  -1

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=36362
  Handle tag files with attribute names that are not valid Java identifiers
  http://svn.apache.org/viewvc?rev=1138950&view=rev
  http://svn.apache.org/viewvc?rev=1138953&view=rev
  http://svn.apache.org/viewvc?rev=1140693&view=rev
  http://svn.apache.org/viewvc?rev=1142043&view=rev
  +1: markt, kkolinko
  -1:

* Multiple improvements to the Windows Installer
  - https://issues.apache.org/bugzilla/show_bug.cgi?id=33262
    Install monitor to auto-start for current user only rather than all users to
    be consistent with menu item creation.
  - Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=40510
    Provide an option to install shortcuts for the current user or all users.
    Also ensure registry is correctly cleaned on uninstall for 64-bit platforms.
  - Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50949
    Provide the ability to specify the AJP port and service name when installing
    Tomcat using the Windows installer. This permits multiple instances of the
    same Tomcat version to be installed side-by-side.
  - Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51135
    Fix auto-detection of JAVA_HOME for 64-bit Windows platforms that only have
    a 32-bit JVM installed.
  - Simplify the installer by using search and replace for server.xml
  - Provide the ability to configure the shutdown port
  - Provide service name and port validation
  - Update to Commons daemon 1.0.6
  - Removes res/confinstall/server*.xml, res/tick*.bmp, res/main.ico,
            res/uninst.ico
  http://people.apache.org/~markt/patches/2011-08-01-windows-installer-multiple-tc6.patch
  +1: markt
  -1:

* The change in session ID is notified to not the session listener but the 
  container event listener.
  http://svn.apache.org/viewvc?view=revision&revision=1141441
  +1: kfujino, markt, kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49929
  No definitive information that this is the fix but back-porting Mladen's fix
  from 7.0.x can't hurt and may help
  http://svn.apache.org/viewvc?view=revision&revision=1066772
  +1: markt, kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49595
  http://svn.apache.org/viewvc?rev=1148216&view=rev
  +1: jfclere, kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51509
  Correct concurrency issue in CSRF prevention filter
  http://svn.apache.org/viewvc?rev=1148471&view=rev
  +1: markt, kkolinko
  -1:
  
* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51515
  Prevent immediate socket close when comet is used over HTTPS
  http://people.apache.org/~markt/patches/2011-07-22-bug51515-tc6.patch
  (note: The only change to NioEndpoint is adding a sync)
  +1: markt
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51588
  Make it easier to extend the AccessLogValve to add support for custom elements
  http://svn.apache.org/viewvc?rev=1152601&view=rev
  +1: markt, kkolinko
  -1:
