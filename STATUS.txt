================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Revision$ $Date$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]

PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]


* Add ManagerBase session getLastAccessedTimestamp and getCreationTimestamp for better
  remote JMX access.
  http://svn.apache.org/viewvc?rev=612971&view=rev
  +1: pero, rjung, fhanik, markt
  -1: remm: I believe it would need specific support for certain managers. Interested users
            could use their own extended manager instead.

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45015
  You can't use an unescaped quote if you quote the value with that character
  http://svn.apache.org/viewvc?rev=657231&view=rev
  +1: markt
  -1: remm (I think it is a good patch, but it throws an error for something which was working before,
            so I would think keeping it for the next release would be better)
      markt How about making it optional with a system property that can be used
            to restore the current behaviour is an app depends on it?
      remm Ok with this addition, but I would only vote +0 for inclusion in this release
           (this still sounds like a very minor fix)

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42750
  Make parsing of request line more tolerant of multiple SP and/or HT
  Note: This is on the critical path
  http://svn.apache.org/viewvc?rev=657954&view=rev
  +1: markt, jfclere
  -1: 
  +0: remm

* After being done with an asynchronous sendfile, the socket should go to the poller (if assigned
  to a worker, it will block).
Index: java/org/apache/tomcat/util/net/AprEndpoint.java
===================================================================
--- java/org/apache/tomcat/util/net/AprEndpoint.java	(revision 658292)
+++ java/org/apache/tomcat/util/net/AprEndpoint.java	(working copy)
@@ -1787,11 +1787,9 @@
                                     // Destroy file descriptor pool, which should close the file
                                     Pool.destroy(state.fdpool);
                                     Socket.timeoutSet(state.socket, soTimeout * 1000);
-                                    // If all done hand this socket off to a worker for
+                                    // If all done put the socket back in the poller for
                                     // processing of further requests
-                                    if (!processSocket(state.socket)) {
-                                        Socket.destroy(state.socket);
-                                    }
+                                    getPoller().add(state.socket);
                                 } else {
                                     // Close the socket since this is
                                     // the end of not keep-alive request.
  +1: remm, jfclere
  -1: 

* Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=43683
  Reloaded context has new classloader so the context classloader needs to
  be reset
  http://svn.apache.org/viewvc?rev=661074&view=rev
  +1: markt, remm, pero
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45101
  Format header dates obtained from DirContextURLConnection as per HTTP spec
  Patch provided by Chris Hubick
  http://svn.apache.org/viewvc?rev=661488&view=rev
  +1: markt, remm (but there's downside as naming now depends on the utils)
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42934
  Change the order of events on context start so contextInitialized() event is
  fired before sessionDidActivate(). The spec isn't 100% clear on the required
  order but this seems more logical than the current behaviour.
  http://svn.apache.org/viewvc?rev=654932&view=rev
  +1: markt, remm, pero
  -1: 

* Enhancement https://issues.apache.org/bugzilla/show_bug.cgi?id=45155
  Provide a workaround to a buggy MS WebDAV client.
  http://svn.apache.org/viewvc?rev=664345&view=rev
  +1: markt
  -1: 

* Provide belt and braces XSS protection. Really an app responsbility but worth
  protecting against in case the app forgets.
  http://svn.apache.org/viewvc?rev=664483&view=rev
  +1: markt
  -1: 
