================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Revision$ $Date$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]

* Modify NIo connector to use JSSE SSL implementation directly
  http://svn.apache.org/viewvc?rev=616896&view=rev
  +1: markt, fhanik
  +1: remm: ok
            (markt) This is not an API change. It is preparation for an API
                    change which will now be in a future release. The method
                    that needs to be removed will now be marked as deprecated
                    in 6.0.x (see patch below).

* lib is relative to catalina home, not base
  http://svn.apache.org/viewvc?rev=627602&view=rev
  +1: markt, fhanik, jim
  -1: 

* Fix NPE when iterating through sessions for expiration
  http://svn.apache.org/viewvc?view=rev&revision=627689
  +1: fhanik, markt, remm, jfclere
  -1:
  
* Add tests for the cookie parsing and use package org.apache.catalina.tomcat.util.http
  http://people.apache.org/~jfclere/patches/test_cookies.patch2
  +1: jfclere, fhanik, markt
  -1:

* Point to Wiki for latest status and remove very out of date status page from
  docs
  http://svn.apache.org/viewvc?rev=630006&view=rev
  +1: markt, fhanik, jim
  -1:

* Update docs. Correct version number, paths and use of $CATALINA_HOME vs.
  $CATALINA_BASE
  http://svn.apache.org/viewvc?rev=630013&view=rev
  +1: markt, fhanik, jfclere
  -1:
  
PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]


* Add ManagerBase session getLastAccessedTimestamp and getCreationTimestamp for better
  remote JMX access.
  http://svn.apache.org/viewvc?rev=612971&view=rev
  +1: pero, rjung, fhanik, markt
  -1: remm: I believe it would need specific support for certain managers. Interested users
            could use their own extended manager instead.

* Remove old TLS code
  http://svn.apache.org/viewvc?rev=616894&view=rev
  +1: markt, fhanik
  +0: remm: I don't see the point of backporting these API changing cleanups
            (markt) This is not an API change. It is just removing the TLS code
                    that has never been included in a 6.0.x src or bin release
           It's my fault for not building it in then. I'm not sure this is intentional,
           but I am ok with the change.

* Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=44282
  Do call to getClassLoader() in a privileged block.
  http://svn.apache.org/viewvc?rev=616953&view=rev
  +1: markt, fhanik
  +0: remm: do we really want to fix these sort of "bugs" ?
  -1:

* Allow to specify the random device to use. (/dev/urandom is faster).
  http://svn.apache.org/viewvc?view=rev&revision=602114
  http://svn.apache.org/viewvc?view=rev&revision=601795
  +1: jfclere, fhanik
  +0: markt, jim - should really be added to the docs as well
  -1:

* Revert back to original patch proposed for UTF8 parsing.
  This also fixes the regression for 6.0.16 and 5.5.26 (and possibly 4.1.37) mentioned in 
  http://issues.apache.org/bugzilla/show_bug.cgi?id=44494
  
  The original patch can be viewed
  http://people.apache.org/~fhanik/tomcat/b2c/patch.txt

  http://svn.apache.org/viewvc?rev=568307&view=rev
  http://svn.apache.org/viewvc?rev=568605&view=rev

  +1: fhanik
  -0: billbarker The original patch s*cks bigtime.  I agree with remy (on list) that this issue should have 
                 involved a discussion on list on how to fix, rather than just proposing a 5 sec fix.
  -1: markt This patch removes a method from a public API. With that issue fixed
            I would vote -0 until I can look at this further as explained in
            http://marc.info/?l=tomcat-dev&m=120457882215329&w=2
  -0: remm The newer code looks cleaner to me, so I propose this patch (bb.getLength() is equal to the
           value used as the result of available in the other proposed patch, and thez are thus using
           the same limit for reading data):
  Index: java/org/apache/catalina/connector/InputBuffer.java
===================================================================
--- java/org/apache/catalina/connector/InputBuffer.java	(revision 633279)
+++ java/org/apache/catalina/connector/InputBuffer.java	(working copy)
@@ -355,7 +355,7 @@
         }
 
         state = CHAR_STATE;
-        conv.convert(bb, cb, len);
+        conv.convert(bb, cb, bb.getLength());
         bb.setOffset(bb.getEnd());
 
         return cb.getLength();
  
