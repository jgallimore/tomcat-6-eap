================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Id$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]

PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]

* Add StuckThreadDetectionValve
  https://github.com/sylvainlaurent/tomcat60/commit/252334f958877221ecb2dc64ee0fd12bb77e360b
  +1: slaurent
  +1: kkolinko: several comments are below
  -1:
  kkolinko: To view/download this as a patch file you add ".diff" to the URL above. That is:
  https://github.com/sylvainlaurent/tomcat60/commit/252334f958877221ecb2dc64ee0fd12bb77e360b.diff

  kkolinko: Minor glitches:
    - In mbeans-descriptors.xml:
      - There are no properties "asyncSupported", "stateName" in TC6 version of this valve.
    - In valve.xml:
      - s/tomcat log/Tomcat log/ (or Apache Tomcat log)
    - In StuckThreadDetectionValve.java:
      - private classes CompletedStuckThread, MonitoredThread: make them static (r1175897)
      - Use Long.valueOf() and explicit boxing/unboxing (r1138132, r1175897)
      - getStuckThreadIds() returns a list of ids. It might be useful to
        have a similar method that returns Thread.getName() names.

* Fix autodeployment of applications that have configuration errors.
  If autodeployment fails, create DeployedApplication object and register
  what we deployed (xml or war or dir - a single file) as redeployResource.
  If it is updated the application will be redeployed.
  + ContainerBase patch adds display of failed apps in manager. They can be
  listed and undeployed.
  http://people.apache.org/~kkolinko/patches/2011-11-14_tc6_HostConfig.patch
  http://people.apache.org/~kkolinko/patches/2011-11-14_tc6_ContainerBase.patch
  +1: kkolinko
  -1:

* Add denyStatus attribute to RequestFilterValve
  (RemoteAddrValve, RemoteHostValve valves). It allows to use different
  HTTP response code when rejecting denied request. E.g. 404 instead of 403.
  http://people.apache.org/~kkolinko/patches/2011-11-16_tc6_RequestFilterValve_denyStatus.patch
  (r1202565 in trunk, r1202570 in TC7)
  +1: kkolinko, rjung, fhanik
  -1:

* Backport SetCharacterEncodingFilter
  1) patch
   http://people.apache.org/~kkolinko/patches/2011-12-22_tc6_SetCharacterEncodingFilter.patch
  2)
   svn propset svn:eol-style native java/org/apache/catalina/filters/SetCharacterEncodingFilter.java
  3) Add example of configuration to conf/web.xml:
   http://svn.apache.org/viewvc?rev=1228210&view=rev
  +1: kkolinko, rjung, kfujino
  -1:

* Improvements to Windows installer:
  1. When building a Windows installer do not copy whole "res" folder to
     output/dist, but only the files that we need. Make sure that
     INSTALLLICENSE file has correct line ends.
  2. Remove <code>res/License.rtf</code>. The file that is actually shown
     by the Windows installer is <code>res/INSTALLLICENSE</code>.

  It is backport of r1231779 of Tomcat 7.
  1) Execute command:
    svn del res/License.rtf
  2) Patch
    http://people.apache.org/~kkolinko/patches/2012-01-18_tc6_LicenseRtf.patch

  +1: kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52579
  Propose new implementation of ByteChunk.toStringInternal().
  This fix does not reintroduce issue BZ51400.
  This fix avoids http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6196991.
  https://issues.apache.org/bugzilla/attachment.cgi?id=28274
  +1: kfujino, fhanik
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52606
  Ensure replayed POST bodies are available when using AJP
  http://svn.apache.org/viewvc?rev=1241985&view=rev
  +1: markt, kfujino, fhanik
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51477
  Support all SSL/TLS protocol combinations in APR connector.
  trunk/TC7 (applies clean except for docs):
    http://svn.apache.org/viewvc?rev=1145209&view=rev
  TC 6 patch:
    http://people.apache.org/~rjung/patches/tc6-apr-all-sslprotocol-r1145209.patch
  +1: rjung, mturk, fhanik
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52719
  Correct theoretical resource leak during Jar validation
  http://svn.apache.org/viewvc?rev=1298143&view=rev
  +1: markt, fhanik
  -1:

* Replicate Principal in ClusterSingleSignOn.
  http://svn.apache.org/viewvc?view=revision&revision=1298299
  +1: kfujino, fhanik
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52500
  Add configurable mechanism to retrieve user names from X509 client certificates.
  trunk patch: http://svn.apache.org/viewvc?view=revision&revision=r1298476
  +1: schultz. fhanik
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52723
  Correct theoretical resource leak in StandardManager
  http://svn.apache.org/viewvc?rev=1299036&view=rev
  +1: markt, fhanik
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52830
  Lookups using javax.naming.Name fail
  http://svn.apache.org/viewvc?rev=1298635&view=rev
  +1: markt
  +1: fhanik - would have been easier to read if 90% of the patch wasn't document/formatting related
  -1:

* https://issues.apache.org/bugzilla/show_bug.cgi?id=52811
  Fix parsing of Content-Type
  http://svn.apache.org/viewvc?rev=1300155&view=rev (new HTTP header parser)
  http://svn.apache.org/viewvc?rev=1300161&view=rev (the actual fix)
  +1: markt
   0: fhanik - introducing a new parser this late into a release seems too risky for 6
  -1:

* Fix bug https://issues.apache.org/bugzilla/show_bug.cgi?id=52858
  http://svn.apache.org/viewvc?rev=1300948&view=rev
  +1: fhanik
  -1:
  
* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52918
  Add WebSocket support to Tomcat 6
  +1: fhanik
    

PATCHES/ISSUES THAT ARE STALLED

* Backport JSP unloading patch (BZ48358).
  The patch has substantially changed since the original version.
  Original revisions are: 937787, 1028377, 1028389, 1028396, 1028861, 1028862, 1028863,
  1028935, 1028939, 1028940, 1028944, 1028950, 1030014, 1030037
  Combined TC 6 patch:
  http://people.apache.org/~rjung/patches/BZ48358-JSP_Unloading-TC6_20101118.patch
  +1: rjung
  -0: markt - http://markmail.org/thread/777be426ulcfmdd3 suggests there may be
              a memory leak in this code somewhere. I'd like to get to the
              bottom of that before porting this
      rjung:  I started a discussion about JSPs and memory on the dev list.
              The updated patch fixes a race condition.
              We can stall this item until we get some feedback about 7.0.5.
      markt - r1172614 needs to be included in this proposal. With that patch,
              my testing shows that the unloading works as designed
  -1:
