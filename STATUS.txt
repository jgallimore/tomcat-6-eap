================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Id$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]


PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]

* Fix the maven stuff for the maven repo.
  Before it does't find tomcat-juli.jar and the remoteRepository seems broken .
  http://people.apache.org/~jfclere/patches/maven.patch
  +1: jfclere
  -1: fhanik - easier to pass in the root path (lib/bin) to the macro instead of hacking around it
               if we remove the SCP auto feature, then there should be something to replace it with
               (http://ant.apache.org/manual/OptionalTasks/scp.html)  

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48545
  Truststores don't have to have passwords
  Based on a patch by 'smmwpf54'
  http://svn.apache.org/viewvc?view=revision&revision=910266
  +1: markt
  -1: jfclere: Doc says it should use keystorePass (http://tomcat.apache.org/tomcat-6.0-doc/config/http.html).
               so that would break existing configurations.
      markt: It shouldn't break existing configs. JSSE allows trust stores to be
             read without providing the password

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49030
  Failure of one connector should not leave some connectors started and some
  ignored
  http://svn.apache.org/viewvc?rev=929521&view=rev
  +1: markt
  -1: 
  +0: kkolinko: good, but maybe we should also prevent against starting
    those connectors, that failed to initialize, in StandardService#start()?
    Also the message name (some generic name, "connector.failed"), vs.
    message text ("starting"),  vs. what actually happened (initialize()) -
    I won't insist on fixing that inconsistency.

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48379
  Make session cookie name, domain and path configurable per context.
  Updated patch in response to review comments from kkolinko & rjung
  http://people.apache.org/~markt/patches/2010-05-18-bug48379.patch
  +1: markt
  -1: kkolinko: Reviewing the code it looks that
    context.getSessionCookieName() now returns null by default, like it does
    in TC7. That is good, but this null result is not taken care of in
    Request.java, JvmRouteBinderValve.java

* Configure Tomcat to use HttpOnly for session cookies by default
  http://people.apache.org/~kkolinko/patches/2010-04-21_tc6_context_httpOnly.patch
  +1: kkolinko
  -0: markt - There wasn't consensus previously.
            - If you are going to change the default, do it in the code
  -1:

* Backport a couple of loader fixes and enhancements:

  Expose properties of VirtualWebappLoader and WebappClassLoader via JMX.
  http://svn.apache.org/viewvc?view=revision&revision=936819
  +1: rjung, markt, kkolinko
  -1: 
   kkolinko:
     1) Descriptions should be written on a single line.
        When they are split into several lines it looks nasty in JConsole (JDK 6u20)
     2) Maybe capitalize "uRLs" as "URLs"?
        I tested and either one of these two capitalization variants works correctly.
        Though you need to configure a VirtualWebappLoader to test that:
        without it the property is always a zero-length array.

  Add property "searchExternalFirst" to WebappLoader:
  If set, the external repositories will be searched before
  the WEB-INF ones. Default (false) is unchanged behaviour.
  Also expose the new property via JMX and document it.
  http://svn.apache.org/viewvc?view=revision&revision=936823
  http://people.apache.org/~rjung/patches/2010-05-14-loader-backport-r936823.patch
  +1: rjung
  -1: markt - The new block
              if (hasExternalRepositories && searchExternalFirst) {...}
              needs to silently swallow CNFE to have same behaviour as previous
              code

  Expose the new WebappLoader flag in the VirtualWebappLoader,
  but allow alternative name searchVirtualFirst to make it
  consistent with the "virtual" terminology.
  Now you can decide, whether the virtual paths will
  be searched before the webapp or after it.
  If searched before, external resources take precendence
  over internal ones. Before that change one couldn't overwrite
  resources already present in the webapp.
  http://svn.apache.org/viewvc?view=revision&revision=936825
  http://people.apache.org/~rjung/patches/2010-05-14-loader-backport-r936825.patch
  +1: rjung
  -1: 

  Respect configurable search order in getURLs().
  http://svn.apache.org/viewvc?view=revision&revision=936892
  http://people.apache.org/~rjung/patches/2010-05-14-loader-backport-r936892.patch
  +1: rjung
  -1: 

  Add the new contextName property of WebappClassLoader
  to its toString() and expose as read only via JMX.
  http://svn.apache.org/viewvc?view=revision&revision=944396
  http://people.apache.org/~rjung/patches/2010-05-14-loader-backport-r944396.patch
  +1: rjung, markt, kkolinko
  -1: 

* Fix missing message text and logging with unexpected logger issues in cluster
  listeners
  http://people.apache.org/~markt/patches/2010-05-19-lost-messages.patch
  +1: markt, rjung, kkolinko
  -1: 

* Fix ByteChunk.indexOf(String, ...) when the string is of length 1
  http://svn.apache.org/viewvc?rev=945231&view=rev
  +1: kkolinko, markt
  -1:
              
* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48990
  Fix the skip.installer build property so once set, the Windows installer is
  skipped but all the other artifacts are created
  https://issues.apache.org/bugzilla/attachment.cgi?id=25477&action=edit
  +1: markt, kkolinko
  -1: 

* Fix issues running AJP BIO coyote connector under a security manager
  http://svn.apache.org/viewvc?rev=947717&view=rev (less changes to loadUtilPackage())
  +1: markt, kkolinko
  -1: 

* Additional clean-up possible as a result of above fix
  http://svn.apache.org/viewvc?rev=950905&view=rev (associated clean-up)
  +1: markt
  -1: 
  
* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49095
  AprEndpoint does not wakeup accepts with deferred accept or BSD filters
  Based on a patch provided by Ruediger Pluem
  https://issues.apache.org/bugzilla/attachment.cgi?id=25266
  +1: markt
  -1: 
  +0: kkolinko: I updated the above patch to use explicit encoding when
  creating the writer:
  https://issues.apache.org/bugzilla/attachment.cgi?id=25510
  +1: kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49196
  Avoid NPE in PageContext.getErrorData()
  http://svn.apache.org/viewvc?rev=948057&view=rev
  +1: markt, kkolinko
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49343
  When ChannelException is thrown, remove listener from channel.
  http://svn.apache.org/viewvc?view=revision&revision=948402
  +1: kfujino, kkolinko
  -1: 
   kkolinko:
    Maybe "this.channel.removeChannelListener(this.rpcChannel);" call
    has to be replaced with "this.rpcChannel.breakdown();"


* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48971
  Make stopping of leaking Timer threads optional
  http://svn.apache.org/viewvc?rev=950164&view=rev
  +1: markt
  +1: kkolinko (with r950614)
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49099
  Provide a mechanism for including requests rejected by the CoyoteAdapter in
  the standard access log
  http://svn.apache.org/viewvc?rev=950587&view=rev
  +1: markt
  +1: kkolinko: only if together with r950809
  -1: 
   kkolinko: 1) JDBCAccessLogValve is not a child of AccessLogValve, will need
   its own implementation. 2) It would be nice to log requests using the timestamp
   when it was received (like HTTPD 2.0+ does), not when it was processed. If that
   is to be implemented, an additional parameter will be needed for the log() method
   in the AccessLog interface. I suppose that might be "long t1, long t2" instead
   of "long time".
   3) I see no way to turn off this feature or filter the output.

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49178
  Provide commented out additional permission for code located in
  $CATALINA_BASE/lib
  http://svn.apache.org/viewvc?rev=950596&view=rev
  +1: markt
  +1: kkolinko: s/ie/i.e./ in the comment
  -1: 

* Fix issue that is similar to https://issues.apache.org/bugzilla/show_bug.cgi?id=48843
  Prevent possible deadlocks in AprEndpoint.Poller and AprEndpoint.Sendfile,
  caused by missing Object.notify() wakeup,
  http://svn.apache.org/viewvc?rev=950851&view=rev
  (Easier to review if you ignore whitespaces during the diff)
  +1: kkolinko
  -1:
