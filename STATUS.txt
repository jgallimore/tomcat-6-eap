================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Revision$ $Date$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]

PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]

*  Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=36155
   Port the fix from the JK Connector to the AJP and APR Connectors
   http://svn.apache.org/viewvc?rev=672454&view=rev
   +1: billbarker
   -1: remm: No, this gets called all the time, and we're trying to fix a small issue. The real
             solution would be to recycle the fields since as mentioned here it is the cause of 
             the problem (the "local" fields will often never change, but there's no real 
             guarantee overall - it mostly breaks down if there are multiple connectors, with AJP,
             and seems impossible to anticipate):
             https://issues.apache.org/bugzilla/show_bug.cgi?id=36155#c17

* Fix comet behavior
  Invoke READ when there is a body and make sure END is called if CometEvent.close is called during an invokation
  http://svn.apache.org/viewvc?rev=677473&view=rev
  +1: fhanik, funkman
   0: remm: no idea if it's better or worse (the fact that it's been closed is visible)
  -1: 

* Fix issue where the first request for a deleted JSPs returns as if the JSP
  still exists.
  http://svn.apache.org/viewvc?view=rev&revision=683969
  +1: markt
   0: remm (looks risky, very minor problem)
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45608
  Prevent race condition for allocate/deallocate in StandardWrapper
  http://svn.apache.org/viewvc?rev=685177&view=rev
  +1: markt
   0: remm: The only unsafe usage of this field is to implement the gimmick loop-wait hack,
            which to me means adding any sort of sync is not worth it.
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45074
  http://svn.apache.org/viewvc?rev=689402&view=rev
  +1: jfclere
   0: markt: The OP was using linux so I assume they saw some benefit.
             If this is goign to be applied, the docs should be
             updated as well.
  -0: remm: configuring this is useless (esp on Windows, only the default behavior gives acceptable performance)
  -1: 

* Handle session suffix rewrite at JvmRouteBinderValve with parallel requests from same client
  http://svn.apache.org/viewvc?rev=693378&view=rev
  +1: pero, fhanik
  -1: 

* Fix log a warning if we create maxThreads
  http://svn.apache.org/viewvc?rev=694951&view=rev
  +1: markt
   0: remm (other endpoints have the same logic but no patch, and logging could pile up quickly)
      markt Because thread count only grows there will only ever be one log message
      fhanik would be useful to have the patch consistent across endpoints
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44382
  Use HttpOnly for session cookies. This is enabled by default. Feel free to
  caveat your vote with a preference for disabled by default.
  http://svn.apache.org/viewvc?rev=694992&view=rev
  +1: mark (prefer enabled, happy with disabled), rjung
   0: remm (not so elegant, not sure about default value)
      markt It can be improved once the API is fixed in the 3.0 spec
      fhanik why did we change it in trunk to begin with if we are gonna change it again when the spec comes out
             lets just implement the spec in trunk, and discuss the simplest solution for 6.0.x
             but I don't agree with changing the default value
  -1: 
  rjung: slightly prefer enabled for 6.0.x because of increased security by default,
         but disabled for tc5.5.x because of the small risk of breaking existing apps.

* Allow asynchronous close() and setTimeout() on CometEvents
  http://svn.apache.org/viewvc?view=rev&revision=645175
  +1: fhanik
   0: remm (maybe, don't know ...), pero ( Is close and timeout also working with APR? remm: APR does not do per connection timeout)
  -1: 

* More EL fixes. Add lookaheads to prevent parsing ambiguity
  http://svn.apache.org/viewvc?rev=696780&view=rev (the change)
  http://svn.apache.org/viewvc?rev=696782&view=rev (the auto generated code)
  +1: mark, remm
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45026
  Never use empty reason phrase.
  http://svn.apache.org/viewvc?rev=697183&view=rev
  +1: rjung, mturk, markt
   0: remm (also affects to the two other AJP connectors)

* Allow huge request body packets for AJP13.
  This was already applied to connectors, but never
  carried forward to trunk and tc6.0.x.
  http://svn.apache.org/viewvc?rev=697192&view=rev
  Original change: http://svn.apache.org/viewvc?rev=486217&view=rev
  +1: rjung, mturk, markt, pero
   0: remm (also affects to the two other AJP connectors)

* Add CombinedRealm and LockOutRealm with docs
  http://people.apache.org/~markt/patches/2008-09-24-lockout-realm.patch
  +1: markt, remm (but you should stop adding features at some point), fhanik
  -1: 

* Update tc-native to lastest version:
  http://people.apache.org/~jfclere/patches/patch.new-tcnative
  +1: jclere, markt, remm
  -1:

* Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=45878
  Add proper manifests (regression from 5.5.x) and LICENSE & NOTICE files
  Lots of ways to do this. Alternative/better suggestions welcome
  http://svn.apache.org/viewvc?rev=699128&view=rev
  +1: markt, fhanik
  -1: 

* Make the size limit on objects placed in the static resource cache configurable
  http://svn.apache.org/viewvc?rev=699287&view=rev
  +1: markt, remm, fhanik
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45851
  Fix NPE and outof order message processing issues
  http://svn.apache.org/viewvc?rev=699427&view=rev
  +1: markt
   0: 
  -1: 

* Fix serialisation issue reported by Find Bugs
  http://svn.apache.org/viewvc?rev=699633&view=rev
  +1: markt
   0: remm (StdContext was marked as Serializable for an experiment; obviously it won't work)
  -1:

* Fix small memory leak found by Find Bugs
  http://svn.apache.org/viewvc?rev=699634&view=rev
  +1: markt,fhanik
  -1: 

* Fix HTML decoding bug found by Find Bugs
  http://svn.apache.org/viewvc?rev=699635&view=rev
  +1: markt, remm,fhanik
  -1: 

* Fix ASCII parsing bug found by Find Bugs
  http://svn.apache.org/viewvc?rev=699644&view=rev
  +1: markt, remm,fhanik
  -1: 

* Fix casting bug found by Find Bugs
  http://svn.apache.org/viewvc?rev=699645&view=rev
  +1: markt, remm,fhanik
  -1: 

* Fix String comparision bugs found by Find Bugs
  http://svn.apache.org/viewvc?rev=699646&view=rev
  +1: markt
  -0: remm (actually, the optimization would be to return the original String
            if it was not modified, and avoid doing things with a StringBuffer)
    The simplest would be to add a (redundant) check at the beginning of replaceProperties,
    and although the "bug" finder program would complain, I think the == check for the string
    is acceptable:
    public static String replaceProperties(String value, Hashtable staticProp,
            PropertySource dynamicProp[]) {
        if (value.indexOf("$") < 0) {
            return value;
        }
        StringBuffer sb = new StringBuffer();

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45906
  Improve ETag handling in ResourceAttributes
  Patch provided by Chris Hubick
  http://svn.apache.org/viewvc?rev=700125&view=rev
  Note: Deleted getETag(boolean) method to remain but deprecated
  +1: markt, remm (I was -1 originally, but it may not be so bad),fhanik
  -1: 

* Fix some thread safety issues.
  Deprecate (rather than delete) any deleted code that isn't already deprecated
  http://svn.apache.org/viewvc?rev=699714&view=rev (previous patch)
  http://svn.apache.org/viewvc?rev=700167&view=rev (additional changes)
  +1: mark, remm,fhanik
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45933
  Don't use xml parser from web-app to process tld files
  http://svn.apache.org/viewvc?rev=701355&view=rev
  +1: markt
  -0: remm (it is a refactoring, and is not appropriate to me in 6.0.x)

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45403
  See commit message for details of negligable performance impact
  http://svn.apache.org/viewvc?rev=701358&view=rev
  +1: markt
  -0: remm (I also do not think the patch is a good idea as a backport)

* Fix regression in https://issues.apache.org/bugzilla/show_bug.cgi?id=43656
  Patch provided by Nils Eckert
  http://svn.apache.org/viewvc?rev=702632&view=rev
  +1: markt, remm, fhanik
  -1: 

* Fix issue with nested contexts and context.xml files
  http://svn.apache.org/viewvc?rev=702208&view=rev
  +1: markt, remm, fhanik
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45951
  Support changing of JSESSIONID cookie name and jsessionid path parameter name
  http://svn.apache.org/viewvc?rev=702219&view=rev
  +1: markt, fhanik
  -1: 

* Derefence socket when the request is complete
  http://svn.apache.org/viewvc?rev=702676&view=rev
  +1: fhanik, remm
  -1: 

* Port remaining EL changes. This is all the remaining EL related
  patches from trunk
  http://people.apache.org/~markt/patches/2008-10-19-el-tck-various.patch
  +1: markt, remm (let's try it), fhanik
  -1: 

* Backport NCDFE fix from trunk (TCK failures without it)
  http://svn.apache.org/viewvc?rev=640888&view=rev 
  +1: markt
   0: remm (no clue how it can cause a NCDF, and the TCK actually works for me; besides that code is 
            really old to me, so where would this come from ?)
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45285
  Correctly handle annotations in parent classes
  http://people.apache.org/~markt/patches/2008-10-20-bug45285-v2.patch
  Based on a patch by Florent BENOIT
  +1: markt, remm, fhanik
  -1: 

* Fix classcast exception upon shutdown(edgecase)
  http://svn.apache.org/viewvc?rev=706433&view=rev 
  +1: fhanik
  -1: 
  
* maxThreads to be 200 by default
  http://svn.apache.org/viewvc?rev=707264&view=rev 
  +1: fhanik
  -1: 
  
* Fix read/write timeout during async comet access
  http://svn.apache.org/viewvc?rev=707670&view=rev 
  +1: fhanik
  -1:  