================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Revision$ $Date$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]

PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]

* Fix issue where the first request for a deleted JSPs returns as if the JSP
  still exists.
  http://svn.apache.org/viewvc?view=rev&revision=683969
  +1: markt, funkman
   0: remm (looks risky, very minor problem), fhanik - minor problem
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45403
  See commit message for details of negligable performance impact
  http://svn.apache.org/viewvc?rev=701358&view=rev
  +1: markt, funkman
  -0: remm (I also do not think the patch is a good idea as a backport)
  -0: fhanik - the bug talks about WEB-INF/lib and reload, that would be when reload="true" which should be considered development only
      So to make this bug actually worth while fixing, and not impact performance, then it should only do this check on files that 
      are relevant to the reload of an application, in other words a watched resource

* Backport cleanup of semantics of thisAccessedTime and
  lastAccessedTime for sessions:
  - preparational whitespace changes
    http://svn.apache.org/viewvc?rev=711695&view=rev
  - Give thisAccessedTime and lastAccessedTime for sessions
    a clear semantics:
    http://svn.apache.org/viewvc?rev=711711&view=rev
    - thisAccessedTime will be updated at the beginning and
      at the end of session use
    - lastAccessedTime will only be updated at the end of
      session use
    This means:
    - lastAccessedTime is the last access time of a session
      disregarding any request still being processed on.
      So this is good to use even from within a request
      to detect when its own session has been used last before.
    - thisAccessedTime already gets updated when a new request 
      disregarding any request still being processed on.
      So this is better for any idleness check or information.
    - thisAccessedTime >= lastAccessedTime always
  - Port from StandardSession to DeltaSession
    http://svn.apache.org/viewvc?rev=711714&view=rev
  - Expose thisAccessedTime via the session interface
    and ManagerBase, so we can use it from outside the session.
    http://svn.apache.org/viewvc?rev=711716&view=rev
  - Make the classes checking session idleness use thisAccessedTime.
    http://svn.apache.org/viewvc?rev=711720&view=rev
    This is not for invalidation, only for displaying
    idle times and making persistance decisions.
  +1: rjung, markt
   0: billbarker: generally agree with remm that this is too big of a change for the stable branch
                 but could agree to some of it if it was split into parts
  -1: remm: no for TC 6.0

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46908
  http://svn.apache.org/viewvc?rev=758365&view=rev
  Try and support java encoding names when using an xml parser provided via the
  endorsed mechanism
  +1: markt, remm, kkolinko
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46967
  Better handling of errors when trying to use Manager.randomFile
  Based on a patch by Kirk Wolf
  Also make behaviour consistent when using a security manager
  http://svn.apache.org/viewvc?rev=763228&view=rev
  +1: markt, rjung, kkolinko
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46985
  Clean up timeout handling
  http://svn.apache.org/viewvc?rev=763262&view=rev
  +1: markt, pero
  -1: kkolinko:
    It looks like it fixes not bug 46985, but some other issue.

    I suppose that there is an issue in existing code that is
    fixed by this patch
    (socket.setSoTimeout( ) calls that change socket timeout,
    but do not restore it to the default value),
    but I would like it to be explicitly stated, analyzed and
    acknowledged.
    
    Also, s/socket/theSocket/ is not needed.

    I propose an alternative patch below.

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46985
  Alternative fix for issue 46985:
  Fix Javadoc and remove dead code in Http11Processor.process(..)
  https://issues.apache.org/bugzilla/attachment.cgi?id=23684
  +1: kkolinko
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42390
  Correct JSP compilation error with nested tagfile tags with variables with
  "AT_BEGIN" scope
  Patch provided by Konstantin Kolinko
  http://svn.apache.org/viewvc?rev=763717&view=rev
  +1: markt, remm (risky ...)
  -1: kkolinko: sorry, but it looks like I have to revoke my own patch
         At very least: it is, indeed, risky: it changes behavior both for
         SimpleTags and Tags, but only SimpleTags were reported to be broken.
         It will need more testing.

* Fix use of non-ASCII characters in property files
  http://people.apache.org/~markt/patches/2009-04-20-native2ascii-de.patch (German)
  http://people.apache.org/~markt/patches/2009-04-20-native2ascii-en.patch (English)
  http://people.apache.org/~markt/patches/2009-04-20-native2ascii-es.patch (Spanish)
  http://people.apache.org/~markt/patches/2009-04-20-native2ascii-fr.patch (French)
  +1: markt
  +0: kkolinko: should not be needed, as old and new are both correct.
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47046
  Deregister all MBeans when the server is stopped
  http://svn.apache.org/viewvc?rev=769979&view=rev
  +1: markt, pero
  +1: kkolinko (ok, but one question:
        in MBeanUtils.java:

        @@ -1401,12 +1417,7 @@
         static void destroyMBean(Context context)
         ..
        +        String domain = context.getParent().getParent().getName();
                 if (domain == null)
                     domain = mserver.getDefaultDomain();

         Can domain be null here, or one of those getParent().foo() calls result in an NPE ?
      )
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47080
  Prevent NPE when mapper makes no matches
  http://svn.apache.org/viewvc?rev=770809&view=rev
  +1: markt, pero
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47086
  Include 64-bit windows binaries in distributions
  Update Windows installer to work automatically on 64-bit machines
  http://svn.apache.org/viewvc?view=rev&revision=770876
  +1: markt, pero, kkolinko
  -1:

* Fix Close Stream at WebappClassLoader after read error
  http://svn.apache.org/viewvc?rev=772872&view=rev 
  +1: pero
  -0: kkolinko: http://marc.info/?l=tomcat-dev&m=124192105131636&w=2
  -1:

* Build files: Apply explicit encoding to all operations that perform filtering.
  http://svn.apache.org/viewvc?rev=776921&view=rev
  +1: kkolinko
  -1:

* Update to NSIS 2.44
  http://svn.apache.org/viewvc?rev=776924&view=rev
  +1: kkolinko
  -1:

* Build files: Calculate current year automatically by using <tstamp>.
  http://svn.apache.org/viewvc?rev=776935&view=rev
  +1: kkolinko
  -1:

* In dist-javadoc target of dist.xml:
   1) use &#169; on the web page, instead of a symbol
   2) use value of ${year}
  Patch:
Index: dist.xml
===================================================================
--- dist.xml	(revision 776003)
+++ dist.xml	(working copy)
@@ -260,7 +260,7 @@
       author="true" version="true"
       windowtitle="Tomcat API Documentation"
       doctitle="Tomcat API"
-      bottom="Copyright &#169; 2000-2008 Apache Software Foundation.  All Rights Reserved."
+      bottom="Copyright &amp;#169; 2000-${year} Apache Software Foundation.  All Rights Reserved."
       additionalparam="-breakiterator"
       maxmemory="256m" >
     </javadoc>

  +1: kkolinko
  -1:

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44943
  For zip/tgz distributives it was already fixed in 6.0.17, 5.5.27.
  Now, apply the same fix to exe distributive.
  http://svn.apache.org/viewvc?rev=776945&view=rev
  +1: kkolinko
  -1:

* Add missing svn properties
  http://people.apache.org/~rjung/patches/tc6-svnprops.patch
  +1: rjung, fhanik
  -1: 

* Don't add extra blank lines to files in .tar.gz distro
  http://svn.apache.org/viewvc?rev=777464&view=rev
  http://svn.apache.org/viewvc?rev=777466&view=rev
  +1: markt
  -1: 
