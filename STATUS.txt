================================================================================
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
================================================================================

$Id$

                         =================================
                         Apache Tomcat 6.0 Patch Proposals
                         =================================


RELEASE SHOWSTOPPERS:


PATCHES ACCEPTED TO BACKPORT:
  [ start all new proposals below, under PATCHES PROPOSED. ]


PATCHES PROPOSED TO BACKPORT:
  [ New proposals should be added at the end of the list ]

* Backport cleanup of semantics of thisAccessedTime and
  lastAccessedTime for sessions:
  - preparational whitespace changes
    http://svn.apache.org/viewvc?rev=711695&view=rev
  - Give thisAccessedTime and lastAccessedTime for sessions
    a clear semantics:
    http://svn.apache.org/viewvc?rev=711711&view=rev
    - thisAccessedTime will be updated at the beginning and
      at the end of session use
    - lastAccessedTime will only be updated at the end of
      session use
    This means:
    - lastAccessedTime is the last access time of a session
      disregarding any request still being processed on.
      So this is good to use even from within a request
      to detect when its own session has been used last before.
    - thisAccessedTime already gets updated when a new request
      disregarding any request still being processed on.
      So this is better for any idleness check or information.
    - thisAccessedTime >= lastAccessedTime always
  - Port from StandardSession to DeltaSession
    http://svn.apache.org/viewvc?rev=711714&view=rev
  - Expose thisAccessedTime via the session interface
    and ManagerBase, so we can use it from outside the session.
    http://svn.apache.org/viewvc?rev=711716&view=rev
  - Make the classes checking session idleness use thisAccessedTime.
    http://svn.apache.org/viewvc?rev=711720&view=rev
    This is not for invalidation, only for displaying
    idle times and making persistance decisions.
  +1: rjung
   0: billbarker: generally agree with remm that this is too big of a change for the stable branch
                 but could agree to some of it if it was split into parts
   0: markt: Agree with Bill - smaller parts would be better
  -1: remm: no for TC 6.0
  -1: funkman : api change in Session.java for .x.x release


* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47774
  Ensure web application class loader is used when calling session listeners
  http://svn.apache.org/viewvc?rev=898555&view=rev
  +1: markt, kkolinko, yoavs
  -1: 

* Fix second part of https://issues.apache.org/bugzilla/show_bug.cgi?id=47413#c8
  Coerce result of composite EL expression (${a}${b}) from String to the expected type.
  The example demonstrating it was added in r892968.
  http://svn.apache.org/viewvc?rev=893001&view=rev
  +1: kkolinko
  -1:
    kkolinko: The current Mark's work on fixing EL issues is expected to
    provide a better fix for this issue.


* Enforce presence of charset in content-type header of textual mime-types in the Examples webapp
  step 1) copy AddDefaultCharsetFilter from trunk
   mkdir "java/org/apache/catalina/filters"
   svn add "java/org/apache/catalina/filters"
   svn copy https://svn.apache.org/repos/asf/tomcat/trunk/java/org/apache/catalina/filters/AddDefaultCharsetFilter.java java/org/apache/catalina/filters/
  step 2) merge r893496 from trunk
   http://svn.apache.org/viewvc?rev=893496&view=rev
  +1: kkolinko
  -1:
    kkolinko: setting org.apache.catalina.STRICT_SERVLET_COMPLIANCE=true
    also provides this feature, and better than this patch does.


* Allow special characters recognized by the Windows command-line shell to
  be present in the names of CATALINA_HOME/_BASE and the current directory
  used to call the Tomcat scripts.
  Fixes the problem reported for the '&' character:
    https://issues.apache.org/bugzilla/show_bug.cgi?id=48464#c4
  "help cmd" lists the following characters as special:
   <space> and &()[]{}^=;!'+,`~
  Note that:
   - cd, set, echo commands have to use quotes when a name contains '&'
   - names containing the space character are already working without this patch
  Patch:
  http://people.apache.org/~kkolinko/patches/2010-01-03_bug48464-c4_ampersand_tc6.patch
  (a backport of revs. 895191, 895392)
  Tested on Windows XP.
  +1: kkolinko, rjung
  -1:
  rjung: I would slightly prefer to apply after we finally managed to produce a working
         release for 6.0.x, since changes in the Windows bat files are hard to test
         for all possible cases, paths etc.
         The 'set "a=%b%"' trick is nice, because if you only use the quotation
         marks around the rhs, Windows actually adds them to the value of 'a'.

* Remove hard coded version numbers and instead apply version filter
  already defined in ant scripts.
  Backport from trunk of
  http://svn.apache.org/viewvc?rev=711934&view=rev
  http://svn.apache.org/viewvc?rev=712053&view=rev
  Complete patch applicable to TC6:
  http://people.apache.org/~rjung/patches/tc6-version_filter.patch
  +1: rjung, yoavs
  -1: 
   kkolinko: (
     -0 for changes of the *.txt files:
        - RELEASE-NOTES
        - RUNNING.txt
        - BUILDING.txt

       1) I see no point. These are specific for the major.minor branch.
       Turning them into a template looks wrong.
       I do not expect doing merges to these files.
       2) It results in an unfiltered BUILDING.txt in our src bundles. That
       is not pretty. This also affects our TC 7 builds.

     +1 for all the other changes
   )

* Fix various EL issues (with test cases) including BZ47413#c8 & BZ48112
  The actual fixes
    svn copy https://svn.apache.org/repos/asf/tomcat/trunk/java/org/apache/jasper/compiler/AttributeParser.java
             https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk/java/org/apache/jasper/compiler/AttributeParser.java
    http://people.apache.org/~markt/patches/2010-01-11-el-part1.patch
  Updates required to generated files after fixes above
    http://people.apache.org/~markt/patches/2010-01-11-el-part2.patch
  The new test cases
    svn copy https://svn.apache.org/repos/asf/tomcat/trunk/test/org/apache/jasper/compiler/TestAttributeParser.java
             https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk/test/org/apache/jasper/compiler/TestAttributeParser.java
    svn copy https://svn.apache.org/repos/asf/tomcat/trunk/test/org/apache/el/TestELEvaluation.java
             https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk/test/org/apache/el/TestELEvaluation.java
    svn copy https://svn.apache.org/repos/asf/tomcat/trunk/test/org/apache/el/TesterFunctions.java
             https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk/test/org/apache/el/TesterFunctions.java
  +1: markt, jim, yoavs
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47977
  Using a body with a tag that has an empty body should cause an error
  http://svn.apache.org/viewvc?rev=898126&view=rev
  http://svn.apache.org/viewvc?rev=898256&view=rev (case insensitivity)
  +1: markt, jim, yoavs
  -1: 

* Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48421
  Prevent file descriptor leak. Allow a web application's logs to be deleted
  once the application has been stopped.
  I haven't figured out why, but this also prevents buffered log messages being
  lost on stop when running as a service. 
  http://svn.apache.org/viewvc?rev=898468&view=rev
  +1: markt, yoavs
  -1: 
